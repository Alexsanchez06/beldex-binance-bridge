{"ast":null,"code":"import axios from 'axios';\nimport { EventEmitter } from 'events';\nimport { encrypt } from '@utils/crypto';\nimport { Warning } from '@utils/error';\nimport config from '@config';\nimport * as Actions from './actions';\nimport * as Events from './events';\nimport dispatcher from './dispatcher';\nconst apiUrl = config.apiUrl,\n      useAPIEncryption = config.useAPIEncryption;\nconst httpClient = axios.create({\n  baseURL: apiUrl\n});\nconst endpoints = {\n  getInfo: '/api/v1/getInfo',\n  getUncomfirmedBeldexTransactions: '/api/v1/getUncomfirmedBeldexTransactions',\n  getSwaps: '/api/v1/getSwaps',\n  swap: '/api/v1/swap',\n  finalizeSwap: '/api/v1/finalizeSwap',\n  createBNBAccount: '/api/v1/createBNBAccount',\n  downloadBNBKeystore: '/api/v1/downloadBNBKeystore'\n};\n\nclass Store extends EventEmitter {\n  constructor() {\n    super();\n    this.store = {};\n    dispatcher.register(async payload => {\n      switch (payload.type) {\n        case Actions.GET_INFO:\n          this.getInfo();\n          break;\n\n        case Actions.GET_UNCONFIRMED_LOKI_TXS:\n          this.getUnconfirmedLokiTransactions(payload);\n          break;\n\n        case Actions.GET_SWAPS:\n          this.getSwaps(payload);\n          break;\n\n        case Actions.SWAP_TOKEN:\n          console.log(\"test\");\n          this.swapToken(payload);\n          break;\n\n        case Actions.FINALIZE_SWAP_TOKEN:\n          this.finalizeSwap(payload);\n          break;\n\n        default:\n          break;\n      }\n    });\n  }\n\n  getStore(key) {\n    return this.store[key];\n  }\n\n  async getInfo() {\n    try {\n      const data = await this.fetch(endpoints.getInfo, 'GET');\n      this.store.info = data.result;\n      this.emit(Events.FETCHED_INFO, data.result);\n    } catch (e) {\n      this.emit(Events.ERROR, e);\n    }\n  }\n\n  async getUnconfirmedLokiTransactions(payload) {\n    try {\n      const data = await this.fetch(endpoints.getUncomfirmedBeldexTransactions, 'GET', payload.content);\n      this.emit(Events.FETCHED_UNCONFIRMED_LOKI_TXS, data.result);\n    } catch (e) {\n      this.emit(Events.ERROR, e);\n    }\n  }\n\n  async getSwaps(payload) {\n    try {\n      const data = await this.fetch(endpoints.getSwaps, 'GET', payload.content);\n      this.emit(Events.FETCHED_SWAPS, data.result);\n    } catch (e) {\n      this.emit(Events.ERROR, e);\n    }\n  }\n\n  async swapToken(payload) {\n    try {\n      const data = await this.fetch(endpoints.swap, 'POST', payload.content);\n      console.log(\"data:\", data);\n      this.emit(Events.TOKEN_SWAPPED, data.result);\n    } catch (e) {\n      this.emit(Events.ERROR, e);\n    }\n  }\n\n  async finalizeSwap(payload) {\n    try {\n      const data = await this.fetch(endpoints.finalizeSwap, 'POST', payload.content);\n      this.emit(Events.TOKEN_SWAP_FINALIZED, data.result);\n    } catch (e) {\n      this.emit(Events.ERROR, e);\n    }\n  }\n\n  async fetch(url, method, params = null) {\n    // Encrypt the params if necessary\n    let encrypted = params;\n\n    if (useAPIEncryption && method.toLowerCase() === 'post') {\n      encrypted = encrypt(params, url);\n    }\n\n    const field = method.toLowerCase() === 'post' ? 'data' : 'params';\n\n    try {\n      const _ref = await httpClient({\n        method,\n        url,\n        [field]: encrypted\n      }),\n            data = _ref.data;\n\n      if (data.status === 200 && !data.success) {\n        throw new Warning(data.result);\n      }\n\n      return data;\n    } catch (e) {\n      console.log(\"Failed fetch \".concat(url, \": \"), e); // If we got an error from the api then throw it\n\n      if (e.response && e.response.data) {\n        throw new Error(e.response.data.result);\n      } // Some other error occurred\n\n\n      throw e;\n    }\n  }\n\n}\n\nexport default new Store();","map":{"version":3,"sources":["/home/nowfil/nowfil/company/beldex/loki-binance-bridge/loki-bridge/src/store/store.js"],"names":["axios","EventEmitter","encrypt","Warning","config","Actions","Events","dispatcher","apiUrl","useAPIEncryption","httpClient","create","baseURL","endpoints","getInfo","getUncomfirmedBeldexTransactions","getSwaps","swap","finalizeSwap","createBNBAccount","downloadBNBKeystore","Store","constructor","store","register","payload","type","GET_INFO","GET_UNCONFIRMED_LOKI_TXS","getUnconfirmedLokiTransactions","GET_SWAPS","SWAP_TOKEN","console","log","swapToken","FINALIZE_SWAP_TOKEN","getStore","key","data","fetch","info","result","emit","FETCHED_INFO","e","ERROR","content","FETCHED_UNCONFIRMED_LOKI_TXS","FETCHED_SWAPS","TOKEN_SWAPPED","TOKEN_SWAP_FINALIZED","url","method","params","encrypted","toLowerCase","field","status","success","response","Error"],"mappings":"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","sourcesContent":["import axios from 'axios';\nimport { EventEmitter } from 'events';\nimport { encrypt } from '@utils/crypto';\nimport { Warning } from '@utils/error';\nimport config from '@config';\nimport * as Actions from './actions';\nimport * as Events from './events';\nimport dispatcher from './dispatcher';\n\nconst { apiUrl, useAPIEncryption } = config;\n\nconst httpClient = axios.create({ baseURL: apiUrl });\nconst endpoints = {\n  getInfo: '/api/v1/getInfo',\n  getUncomfirmedBeldexTransactions: '/api/v1/getUncomfirmedBeldexTransactions',\n  getSwaps: '/api/v1/getSwaps',\n  swap: '/api/v1/swap',\n  finalizeSwap: '/api/v1/finalizeSwap',\n  createBNBAccount: '/api/v1/createBNBAccount',\n  downloadBNBKeystore: '/api/v1/downloadBNBKeystore',\n};\n\nclass Store extends EventEmitter {\n  constructor() {\n    super();\n    this.store = {};\n\n    dispatcher.register(async payload => {\n      switch(payload.type) {\n        case Actions.GET_INFO:\n          this.getInfo();\n          break;\n        case Actions.GET_UNCONFIRMED_LOKI_TXS:\n          this.getUnconfirmedLokiTransactions(payload);\n          break;\n        case Actions.GET_SWAPS:\n          this.getSwaps(payload);\n          break;\n        case Actions.SWAP_TOKEN:\n          console.log(\"test\")\n          this.swapToken(payload);\n          break;\n        case Actions.FINALIZE_SWAP_TOKEN:\n          this.finalizeSwap(payload);\n          break;\n        default: break;\n      }\n    });\n  }\n\n  getStore(key) {\n    return this.store[key];\n  };\n\n  async getInfo() {\n    try {\n      const data = await this.fetch(endpoints.getInfo, 'GET');\n      this.store.info = data.result;\n      this.emit(Events.FETCHED_INFO, data.result);\n    } catch (e) {\n      this.emit(Events.ERROR, e);\n    }\n  }\n\n  async getUnconfirmedLokiTransactions(payload) {\n    try {\n      const data = await this.fetch(endpoints.getUncomfirmedBeldexTransactions, 'GET', payload.content);\n      this.emit(Events.FETCHED_UNCONFIRMED_LOKI_TXS, data.result);\n    } catch (e) {\n      this.emit(Events.ERROR, e);\n    }\n  }\n\n  async getSwaps(payload) {\n    try {\n      const data = await this.fetch(endpoints.getSwaps, 'GET', payload.content);\n      this.emit(Events.FETCHED_SWAPS, data.result);\n    } catch (e) {\n      this.emit(Events.ERROR, e);\n    }\n  }\n\n  async swapToken(payload) {\n    try {\n      const data = await this.fetch(endpoints.swap, 'POST', payload.content);\n      console.log(\"data:\",data)\n      this.emit(Events.TOKEN_SWAPPED, data.result);\n    } catch (e) {\n      this.emit(Events.ERROR, e);\n    }\n  }\n\n  async finalizeSwap(payload) {\n    try {\n      const data = await this.fetch(endpoints.finalizeSwap, 'POST', payload.content);\n      this.emit(Events.TOKEN_SWAP_FINALIZED, data.result);\n    } catch (e) {\n      this.emit(Events.ERROR, e);\n    }\n  }\n\n  async fetch(url, method, params = null) {\n    // Encrypt the params if necessary\n    let encrypted = params;\n    if (useAPIEncryption && method.toLowerCase() === 'post') {\n      encrypted = encrypt(params, url);\n    }\n\n    const field = method.toLowerCase() === 'post' ? 'data' : 'params';\n    try {\n      const { data } = await httpClient({\n        method,\n        url,\n        [field]: encrypted\n      });\n\n      if (data.status === 200 && !data.success) {\n        throw new Warning(data.result);\n      }\n\n      return data;\n    } catch (e) {\n      console.log(`Failed fetch ${url}: `, e);\n\n      // If we got an error from the api then throw it\n      if (e.response && e.response.data) {\n        throw new Error(e.response.data.result);\n      }\n\n      // Some other error occurred\n      throw e;\n    }\n  }\n}\n\nexport default new Store();\n"]},"metadata":{},"sourceType":"module"}